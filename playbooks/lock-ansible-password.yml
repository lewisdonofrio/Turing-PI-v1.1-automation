# =============================================================================
# File: /opt/ansible-k3s-cluster/lock-ansible-password.yml
# =============================================================================
# Purpose:
#   Lock the ansible user's password on all nodes after SSH keys have been
#   installed. This ensures that the ansible account is key-only and cannot
#   authenticate with a password.
#
# Usage:
#   Run as builder:
#     ansible-playbook -i inventory/hosts lock-ansible-password.yml
#
# Notes:
#   - This does NOT disable the ansible account.
#   - SSH key authentication remains fully functional.
#   - Sudo remains passwordless due to /etc/sudoers.d/99-ansible.
# =============================================================================

---
- hosts: all
  become: yes
  tasks:

    - name: Lock ansible password on all nodes
      user:
        name: ansible
        password_lock: yes
