# =============================================================================
# File: /opt/ansible-k3s-cluster/cluster-network-interface-report.yml
# =============================================================================
# Purpose:
#   Generate a cluster-wide network interface report including:
#     - Interface list
#     - Link status
#     - MAC addresses
#     - RX/TX error counters
#
# Usage:
#   ansible-playbook \
#     -i /opt/ansible-k3s-cluster/inventory/hosts \
#     /opt/ansible-k3s-cluster/cluster-network-interface-report.yml
#
# Notes:
#   - Useful for diagnosing flaky NICs, cable issues, and distcc stalls.
# =============================================================================

---
- hosts: k3s_cluster
  become: yes

  tasks:
    - name: Show interfaces
      shell: ip link
      register: link

    - name: Show interface statistics
      shell: ip -s link
      register: stats

    - name: Display interface report
      debug:
        msg:
          - "Interfaces: {{ link.stdout }}"
          - "Statistics: {{ stats.stdout }}"
