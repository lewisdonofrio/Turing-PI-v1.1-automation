# =============================================================================
# File: /opt/ansible-k3s-cluster/cluster-network-bandwidth.yml
# =============================================================================
# Purpose:
#   Generate a cluster-wide network bandwidth report including:
#     - RX/TX byte counters
#     - Interface speeds
#     - Error and drop counters
#     - Bandwidth anomalies
#
# Usage:
#   ansible-playbook \
#     -i /opt/ansible-k3s-cluster/inventory/hosts \
#     /opt/ansible-k3s-cluster/cluster-network-bandwidth.yml
#
# Notes:
#   - Useful for diagnosing distcc slowness and network congestion.
# =============================================================================

---
- hosts: k3s_cluster
  become: yes

  tasks:
    - name: Show interface statistics
      shell: cat /proc/net/dev
      register: netdev

    - name: Show link speed (ethtool)
      shell: ethtool eth0 2>/dev/null | grep -i speed || true
      register: speed

    - name: Display bandwidth report
      debug:
        msg:
          - "Interface Stats: {{ netdev.stdout }}"
          - "Link Speed: {{ speed.stdout }}"
