# =============================================================================
# File: /opt/ansible-k3s-cluster/cluster-cpu-report.yml
# =============================================================================
# Purpose:
#   Generate a cluster-wide CPU report including:
#     - CPU model
#     - Core count
#     - Load averages
#     - CPU frequency
#
# Usage:
#   ansible-playbook \
#     -i /opt/ansible-k3s-cluster/inventory/hosts \
#     /opt/ansible-k3s-cluster/cluster-cpu-report.yml
#
# Notes:
#   - Useful for performance tuning and distcc load balancing.
# =============================================================================

---
- hosts: k3s_cluster
  become: yes

  tasks:
    - name: CPU model
      shell: grep "model name" /proc/cpuinfo | head -n 1
      register: cpu_model

    - name: CPU cores
      shell: nproc
      register: cpu_cores

    - name: CPU frequency
      shell: cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq || true
      register: cpu_freq

    - name: Load averages
      shell: uptime
      register: load_avg

    - name: Display CPU report
      debug:
        msg:
          - "Model: {{ cpu_model.stdout }}"
          - "Cores: {{ cpu_cores.stdout }}"
          - "Frequency: {{ cpu_freq.stdout }}"
          - "Load: {{ load_avg.stdout }}"
